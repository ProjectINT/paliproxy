# Tests

Папка с тестами для ProxyManager. Все тесты автоматически очищают предыдущие логи перед запуском.

## 🚀 Быстрый старт

```bash
# Запустить ВСЕ тесты (рекомендуемый способ)
npm test
```

Эта команда запустит управляющий скрипт `run-all-tests.js`, который:
- ✅ Проверит переменные окружения
- 🧹 Очистит предыдущие логи
- 🔄 Последовательно запустит все тесты
- 📊 Выведет подробный отчет о результатах

## ⚙️ Предварительные требования

**Обязательно** перед запуском тестов:

### 1. Создайте файл `.env` в корне проекта:
```env
# Environment Configuration
NODE_ENV=development
TIMEOUT=5000
HEALTH_CHECK_INTERVAL=60000
HEALTH_CHECK_URL=https://httpbin.org/ip

CHAT_GPT_API_KEY="your_chat_gpt_api_key_here"
```

### 2. Создайте файл `proxies-list.js` с рабочими прокси:
```javascript
module.exports = [
  { ip: '1.2.3.4', port: 1080, user: 'username', pass: 'password' },
  { ip: '5.6.7.8', port: 1080, user: 'username', pass: 'password' },
  // добавьте ваши рабочие прокси
];
```

## 📋 Список тестов

Управляющий скрипт запускает следующие тесты:

## 📋 Список тестов

Управляющий скрипт запускает следующие тесты:

### 1. 🚀 Базовый тест прокси (`proxy-basic-test.js`)
**Основной тест функциональности ProxyManager**
- Работа с реальными прокси из `proxies-list.js`
- Запросы к нескольким URL для проверки IP
- Стандартная конфигурация ProxyManager
- Базовое логирование

### 2. 🔍 Отладочный тест прокси (`proxy-debug-test.js`)
**Детальный отладочный тест с расширенным логированием**
- Подробное логирование с временными метками
- Один URL для упрощенной отладки
- Расширенные таймауты для анализа
- Детальная трассировка ошибок

### 3. 🔄 Тест отказоустойчивости (`proxy-failover-test.js`)
**Тест переключения между прокси при сбоях**

### 4. 🔐 Тест отказоустойчивости с паролем (`proxy-failover-password-test.js`)
**Тест переключения прокси с аутентификацией**

### 5. 💓 Проверка здоровья прокси (`health-check-test.js`)
**Тест системы мониторинга состояния прокси**

### 6. 🌐 Тест API запросов (`request-api-test.js`)
**Тест fetch-like API для работы с запросами**

### 7. ⚡ Быстрый интеграционный тест (`quick-integration-test.js`)
**Быстрая проверка основных компонентов**

### 8. 📦 Тест пакета (`test-package.js`)
**Тест установленного npm пакета**

### 9. 🎵 Тест TTS ReadableStream (`tts-readablestream-test.js`)
**Тест работы с потоковыми данными через прокси**

## 🎯 Индивидуальный запуск тестов

Если необходимо запустить конкретный тест:
## 🎯 Индивидуальный запуск тестов

Если необходимо запустить конкретный тест:

```bash
# Основной тест функциональности
node tests/proxy-basic-test.js

# Детальная отладка
node tests/proxy-debug-test.js

# Тест отказоустойчивости
node tests/proxy-failover-test.js

# Проверка здоровья прокси
node tests/health-check-test.js

# Тест API запросов
node tests/request-api-test.js

# И другие тесты...
```

## 📊 Результаты тестирования

После запуска `npm test` вы получите:

```
═══════════════════════════════════════════════════════════
🚀 ЗАПУСК ВСЕХ ТЕСТОВ PROXY-CONNECTION
═══════════════════════════════════════════════════════════

🔍 Проверка переменных окружения...
✅ Предварительная проверка завершена

🧹 Очистка предыдущих логов...

📋 Базовый тест прокси
   Основной тест функциональности ProxyManager
🔧 Запуск: proxy-basic-test.js
✅ Тест завершен успешно (1250ms)

...

═══════════════════════════════════════════════════════════
📊 ОТЧЕТ О РЕЗУЛЬТАТАХ ТЕСТОВ
═══════════════════════════════════════════════════════════

✅ Успешно: 8
❌ Неудачно: 1
⏱️  Общее время: 15420ms

📋 Детальные результаты:
   ✅ УСПЕХ Базовый тест прокси (1250ms)
   ✅ УСПЕХ Отладочный тест прокси (2100ms)
   ...

📂 Логи сохранены в папке logs/
```

## 🚀 Быстрый запуск

```bash
# Все тесты одной командой (рекомендуется)
npm test
```

---

## Особенности

### 🗑️ Автоматическая очистка логов
Все тесты автоматически очищают предыдущие `.log` файлы в папке `logs/` перед запуском для избежания путаницы при отладке.

### 📁 Структура логов
```
logs/
├── proxy-basic-test.log    # Результаты основного теста
├── proxy-debug-test.log    # Детальные отладочные логи
└── app.log                 # Системные логи ProxyManager (автоматические)
```

### ⚙️ Конфигурация ProxyManager

**Основные параметры:**
- `healthCheckUrl` - URL для проверки работоспособности прокси
- `healthCheckInterval` - Интервал проверки прокси (ms)
- `maxTimeout` - Максимальный таймаут запроса (ms)
- `changeProxyLoop` - Количество циклов смены прокси при неудаче

### 🎯 Цели тестирования

1. **Функциональность** - проверка базовой работы с прокси
2. **Стабильность** - тестирование обработки ошибок
3. **Производительность** - измерение времени отклика
4. **Логирование** - проверка корректности логов

### 📝 Интерпретация результатов

**Успешный тест:**
```
✅ [URL] Status: 200, IP: xxx.xxx.xxx.xxx
```

**Ошибка:**
```
❌ [URL] Error: описание ошибки
```

**В отладочном режиме дополнительно:**
- Временные метки начала/завершения
- Длительность запроса в миллисекундах
- Подробный стек ошибок

### 🔧 Отладка проблем

1. **Сначала запустите** `proxy-debug-test.js` для детального анализа
2. **Проверьте логи** в `logs/proxy-debug-test.log`
3. **Анализируйте** системные логи в `logs/app.log`
4. **При необходимости** измените конфигурацию в тестов

### 🚦 Статусы тестов

- **✅ Успех** - прокси работает, получен корректный ответ
- **❌ Ошибка** - проблемы с прокси или сетью
- **⏱️ Таймаут** - превышено время ожидания
- **🔄 Повтор** - попытка использования другого прокси
